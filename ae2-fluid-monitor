function formatBytes(bytes)
    if bytes >= 1e9 then
        return string.format("%.1fB", bytes / 1e9)
    elseif bytes >= 1e6 then
        return string.format("%.1fM", bytes / 1e6)
    elseif bytes >= 1e3 then
        return string.format("%.1fK", bytes / 1e3)
    else
        return tostring(bytes)
    end
end

function getChemicals()
    local chemicals = {}
    local bridge = peripheral.find("me_bridge")
    if bridge and bridge.listCraftableChemicals then
        chemicals = bridge.listCraftableChemicals() or {}
    end
    return chemicals
end

function formatChemicalName(name)
    return name:match(".+:(.+)") or name
end

function centerText(monitor, text, line)
    local w, _ = monitor.getSize()
    local x = math.floor((w - #text) / 2) + 1
    monitor.setCursorPos(x, line)
    monitor.write(text)
end

function updateDisplay()
    local monitor = peripheral.find("monitor")
    if not monitor then
        print("Kein Monitor gefunden.")
        return
    end

    monitor.setTextScale(1)
    monitor.clear()

    while true do
        monitor.clear()

        local chemicals = getChemicals()

        table.sort(chemicals, function(a, b)
            return (a.amount or 0) > (b.amount or 0)
        end)

        local line = 1
        for _, chem in ipairs(chemicals) do
            local name = formatChemicalName(chem.name or "Unbekannt")
            local amount = chem.amount or 0
            local formattedAmount = formatBytes(amount)
            local displayText = string.format("%s: %s", name, formattedAmount)
            centerText(monitor, displayText, line)
            line = line + 1
        end

        sleep(5)
    end
end

updateDisplay()
