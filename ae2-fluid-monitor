local bridge = peripheral.find("me_bridge")
local monitor = peripheral.find("monitor")

if not bridge then error("Kein ME-Bridge gefunden!") end
if not monitor then error("Kein Monitor gefunden!") end

local function displayFluids()
    monitor.clear()
    monitor.setCursorPos(1,1)
    monitor.write("Fluid Monitor (Bytes)")

    local fluids = bridge.getFluids()
    local used = bridge.getUsedFluidStorage() -- Speichernutzung in Bytes

    if #fluids == 0 then
        monitor.setCursorPos(1,2)
        monitor.write("Keine Fl√ºssigkeiten gefunden.")
    else
        local line = 2
        for _, f in ipairs(fluids) do
            local shortName = f.name:gsub(".*:", "")
            local bytes = 0

            -- Suche den passenden Eintrag in 'used'
            for key, value in pairs(used) do
                if key == f.name then
                    bytes = value
                    break
                end
            end

            monitor.setCursorPos(1,line)
            monitor.write(string.format("%s: %d Bytes", shortName, bytes))
            line = line + 1
        end
    end
end

while true do
    displayFluids()
    sleep(5)
end
